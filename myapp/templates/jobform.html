{% load static %}
<!DOCTYPE html>
<html lang="th" class="{% if pdf_mode %}pdf-mode{% endif %}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% if obj %}ใบสมัคร #{{ obj.pk }}{% else %}ใบสมัครงาน{% endif %}</title>

  <style>
    /* ===== Design Tokens ===== */
    :root{
      --ink:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --brand:#27ae60;
      --brand-2:#2ecc71;
      --card:#ffffff;
      --bg-grad-1:#2c3e50;
      --bg-grad-2:#34495e;
      --radius:10px;
      --gap:20px;
      --nav-h:72px; /* ถ้ามี navbar fixed ด้านบน ปรับตรงนี้ */
    }

    .company-logo{
      width:120px; height:120px; /* หรือ 28mm x 28mm ในโหมด PDF */
      background:#fff; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 4px 10px rgba(0,0,0,.1);
      overflow:hidden;            /* กันรูปเกินขอบมุมโค้ง */
    }
    .company-logo img{
      width:100%; height:100%;
      object-fit:contain;         /* ให้ทั้งโลโก้อยู่ในกรอบไม่บิดเบี้ยว */
      display:block;
    }


    /* ===== Reset & Base ===== */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Verdana,sans-serif;
      color:var(--ink);
      background:linear-gradient(135deg,var(--bg-grad-1),var(--bg-grad-2));
      -webkit-font-smoothing:antialiased;
    }

    /* เว้นที่เผื่อ navbar fixed ด้านบน (ถ้าไม่มีจะไม่เห็นผลกระทบ) */
    .page-pad{padding:20px; padding-top:calc(20px + var(--nav-h));}

    .container{
      max-width:960px; margin:0 auto;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(0,0,0,.18);
      overflow:hidden;
    }

    /* ===== Hero (เฉพาะเว็บ) ===== */
    .hero.only-web{
      background:linear-gradient(135deg,#2c3e50,#3a525f);
      color:#fff;
      padding:28px 28px 20px;
      position:relative;
      isolation:isolate;
    }
    .hero.only-web::before{
      content:""; position:absolute; inset:0; z-index:0;
      background:
        url("data:image/svg+xml,%3Csvg width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M20 20c0 11.046-8.954 20-20 20v-40c11.046 0 20 8.954 20 20zM0 0v20c11.046 0 20-8.954 20-20H0z'/%3E%3C/g%3E%3C/svg%3E");
    }
    .hero-inner{position:relative; z-index:1}
    .hero-top{
      display:grid;
      grid-template-columns: 1fr auto auto;
      align-items:start;
      gap:16px;
      margin-bottom:16px;
    }
    .company-logo{
      width:120px; height:120px;
      background:#fff; color:#1c7a4a; display:flex; align-items:center; justify-content:center;
      border-radius:12px; font-weight:700; box-shadow:0 4px 10px rgba(0,0,0,.1);
    }
    .form-code{
      align-self:start; justify-self:end;
      background:var(--brand); color:#fff; padding:8px 14px; border-radius:8px;
      font-size:12px; font-weight:700; letter-spacing:.6px;
    }
    .photo-box{
      width:120px; height:150px; border:1px solid rgba(255,255,255,.35);
      border-radius:12px; background:#e5e7eb; overflow:hidden; justify-self:end;
    }
    .photo-box img{width:100%; height:100%; object-fit:cover; display:block}

    .hero-title{ text-align:center; margin-top:6px; }
    .hero-title h1{ margin:0; font-size:26px; font-weight:800; letter-spacing:.6px}
    .hero-title h2{ margin:6px 0 2px; font-size:20px; font-weight:700}
    .hero-title p{ margin:0; font-size:13px; opacity:.9; font-style:italic}

    /* ===== Content ===== */
    .content{ padding:28px; background:#fafafa; }
    .section{
      background:#fff; border:1px solid var(--line);
      border-left:4px solid var(--brand);
      border-radius:12px; padding:20px;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
      margin-bottom:20px;
    }
    .section h3{
      margin:0 0 14px; font-size:15px; font-weight:800; letter-spacing:.4px;
      color:#0f172a; text-transform:uppercase;
      padding-bottom:8px; border-bottom:1px solid var(--line);
    }

    /* Form Grid ที่เสถียร */
    .grid{ display:grid; gap:16px; }
    .grid-2{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    .grid-3{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    .grid-auto{ grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    @media (max-width: 720px){
      .grid-2,.grid-3{ grid-template-columns: 1fr; }
      .hero-top{ grid-template-columns: auto 1fr; }
      .form-code{ grid-column: 2; justify-self:start; }
      .photo-box{ grid-column: 2; justify-self:end; }
      .company-logo{ width:90px; height:90px; }
    }

    label{ display:block; margin:0 0 6px; font-size:14px; color:#0f172a; font-weight:600 }
    input,select,textarea{
      width:100%; padding:10px 12px;
      border:1px solid #cbd5e1; border-radius:10px; background:#fff; font-size:14px;
      transition:border-color .2s, box-shadow .2s; font-family:inherit;
    }
    input:focus,select:focus,textarea:focus{
      outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(39,174,96,.18);
    }
    textarea{ resize:vertical; min-height:92px }

    .checkbox-grid{
      display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      margin-top:6px;
    }
    .checkbox-item{
      display:flex; gap:10px; align-items:center; padding:10px 12px;
      border:1px dashed #dbe3ea; border-radius:10px; background:#fbfcfd; font-size:14px;
    }

    .file-upload{ position:relative }
    .file-upload input[type=file]{ position:absolute; inset:0; opacity:0; cursor:pointer }
    .file-upload-btn{
      display:flex; align-items:center; justify-content:center; gap:10px;
      padding:14px; border:2px dashed var(--brand); border-radius:12px;
      background:#f2fff6; color:#0f5132; font-weight:700;
    }

    .submit-wrap{ margin-top:12px }
    .submit-btn{
      width:100%; padding:14px 18px;
      border:none; border-radius:12px; cursor:pointer;
      background:linear-gradient(135deg,var(--brand),var(--brand-2));
      color:#fff; font-weight:800; letter-spacing:.6px; text-transform:uppercase;
      box-shadow:0 8px 18px rgba(39,174,96,.25);
    }

    .footer-note{
      background:#eef2f7; color:#4b5563; font-size:12px; text-align:center;
      padding:14px 18px; border-top:1px solid #dbe3ea;
    }

    /* ===== Print/PDF Mode ===== */
    .pdf-mode .only-web{ display:none !important; }
    @page{ size:A4; margin:16mm 14mm 18mm }
    body{ background:#fff }
    .container{ box-shadow:none; border-radius:0 }
    .content{ padding:0; background:#fff }
    .section{ box-shadow:none; margin-bottom:12px; border-radius:8px }
    .photo-box{ width:28mm; height:36mm; border-color:#cbd5e1 }
    .print-header{ padding:8px 0 12px; }
    .print-grid{ display:grid; grid-template-columns: 28mm 1fr 32mm; gap:10px; align-items:start; }
    .print-title{ text-align:center }
    .print-title h1{ margin:0; font-size:18pt; }
    .print-title h2{ margin:3px 0 0; font-size:13pt; }
    .print-title p{ margin:2px 0 0; font-size:9pt; color:#64748b }
  </style>
</head>

<body>
  <div class="page-pad">
    <div class="container">

      <!-- Hero (เว็บเท่านั้น) -->
      <section class="hero only-web">
        <div class="hero-inner">
          <div class="hero-top">
            <div class="company-logo">
              <img src="{% static 'logo.jpg' %}" alt="ASCENDER Logo">
            </div>

            <div class="form-code">ACD-HR-001</div>
            <div class="photo-box">
              {% if obj and obj.cdd_photo %}
                <img src="{{ obj.cdd_photo.url }}" alt="รูปถ่ายผู้สมัคร">
              {% else %}
                <img id="photoPreview" alt="" style="display:none;">
              {% endif %}
            </div>
          </div>
          <div class="hero-title">
            <h1>APPLICATION FOR EMPLOYMENT</h1>
            <h2>ใบสมัครงาน</h2>
            <p>To be completed in own handwriting</p>
          </div>
        </div>
      </section>

      <!-- Header สำหรับ PDF -->
      {% if pdf_mode and obj %}
      <section class="print-header">
        <div class="print-grid">
          <div class="company-logo">
              <img src="{% static 'logo.jpg' %}" alt="ASCENDER Logo">
            </div>
          <div class="print-title">
            <h1>APPLICATION FOR EMPLOYMENT</h1>
            <h2>ใบสมัครงาน</h2>
            <p>To be completed in own handwriting</p>
          </div>
          <div style="text-align:right;">
            <div class="form-code" style="display:inline-block;margin-bottom:6px;">ACD-HR-001</div>
            <div class="photo-box" style="display:inline-block; vertical-align:top; margin-left:8px;">
              {% if obj.cdd_photo %}<img src="{{ obj.cdd_photo.url }}" alt="photo">{% endif %}
            </div>
          </div>
        </div>
      </section>
      {% endif %}

      <main class="content">
        {% if form %}
        <!-- ========= FORM MODE ========= -->
        <form method="post" action="{% url 'jobform_new' %}" enctype="multipart/form-data">
          {% csrf_token %}

          <!-- ประวัติส่วนตัว -->
          <section class="section">
            <h3>ประวัติส่วนตัว</h3>
            <div class="grid grid-3">
              <div>
                {{ form.cdd_title.label_tag }}{{ form.cdd_title }}
              </div>
              <div>
                {{ form.cdd_first_name.label_tag }}{{ form.cdd_first_name }}
              </div>
              <div>
                {{ form.cdd_last_name.label_tag }}{{ form.cdd_last_name }}
              </div>
              <div>
                {{ form.cdd_nickname.label_tag }}{{ form.cdd_nickname }}
              </div>
              <div>
                {{ form.cdd_gender.label_tag }}{{ form.cdd_gender }}
              </div>
              {% if form.birth_date %}
              <div>
                {{ form.birth_date.label_tag }}{{ form.birth_date }}
              </div>
              {% endif %}
              <div>
                {{ form.cdd_age.label_tag }}{{ form.cdd_age }}
              </div>
            </div>

            <!-- อัปโหลดรูป (พรีวิวขึ้นมุมขวาบนของ hero) -->
            <div style="margin-top:10px">
              <label for="id_cdd_photo">อัปโหลดรูปถ่าย (JPG/PNG)</label>
              {{ form.cdd_photo }} {{ form.cdd_photo.errors }}
              <div style="font-size:12px;color:var(--muted)">ขนาดแนะนำ 3×4 ซม. หรือ ~300×400px</div>
            </div>
          </section>

          <!-- การสมัครงาน -->
          <section class="section">
            <h3>การสมัครงาน</h3>
            <div class="grid grid-2">
              <div>{{ form.cdd_position.label_tag }}{{ form.cdd_position }}</div>
              <div>{{ form.education.label_tag }}{{ form.education }}</div>
            </div>
            <div style="margin-top:12px">{{ form.work_exp.label_tag }}{{ form.work_exp }}</div>
            <div style="margin-top:12px">{{ form.start_date_available.label_tag }}{{ form.start_date_available }}</div>
          </section>

          <!-- การติดต่อ -->
          <section class="section">
            <h3>การติดต่อ</h3>
            <div class="grid grid-3">
              <div>{{ form.cdd_tel.label_tag }}{{ form.cdd_tel }}</div>
              <div>{{ form.cdd_email.label_tag }}{{ form.cdd_email }}</div>
              <div>{{ form.cdd_province.label_tag }}{{ form.cdd_province }}</div>
            </div>
          </section>

          <!-- อุปกรณ์ -->
          <section class="section">
            <h3>อุปกรณ์</h3>
            <div class="checkbox-grid">
              <label class="checkbox-item">{{ form.has_pc }} คอมพิวเตอร์</label>
              <label class="checkbox-item">{{ form.has_laptop }} โน้ตบุ๊ค</label>
              <label class="checkbox-item">{{ form.has_wifi }} Wi-Fi</label>
              <label class="checkbox-item">{{ form.has_headphone }} Headphone</label>
              <label class="checkbox-item">{{ form.has_anydesk }} AnyDesk</label>
            </div>
          </section>

          <!-- Resume -->
          <section class="section">
            <h3>Resume / CV</h3>
            <div class="file-upload">
              {{ form.cdd_resume }}
              <div class="file-upload-btn"><span>📎</span><span>เลือกไฟล์ (PDF/DOC)</span></div>
            </div>
          </section>

          <div class="submit-wrap">
            <button type="submit" class="submit-btn">ส่งใบสมัครงาน</button>
          </div>
        </form>

        {% else %}
        <!-- ========= DISPLAY / PDF MODE ========= -->
        <section class="section">
          <h3>ประวัติส่วนตัว</h3>
          <div class="grid grid-auto">
            <div><strong>ชื่อ–สกุล:</strong> {{ obj.get_cdd_title_display }} {{ obj.cdd_first_name }} {{ obj.cdd_last_name }}</div>
            <div><strong>ชื่อเล่น:</strong> {{ obj.cdd_nickname|default:"-" }}</div>
            <div><strong>เพศ:</strong> {{ obj.get_cdd_gender_display }}</div>
            <div><strong>อายุ:</strong> {% if obj.cdd_age %}{{ obj.cdd_age }} ปี{% else %}-{% endif %}</div>
            {% if obj.birth_date %}<div><strong>วันเกิด:</strong> {{ obj.birth_date|date:"d/m/Y" }}</div>{% endif %}
          </div>
        </section>

        <section class="section">
          <h3>การสมัครงาน</h3>
          <div class="grid grid-auto">
            <div><strong>ตำแหน่ง:</strong> {{ obj.get_cdd_position_display }}</div>
            <div><strong>การศึกษา:</strong> {{ obj.education|default:"-" }}</div>
            <div><strong>ประสบการณ์:</strong> {{ obj.work_exp|default:"-" }}</div>
            <div><strong>เริ่มงานได้:</strong> {% if obj.start_date_available %}{{ obj.start_date_available|date:"d/m/Y" }}{% else %}-{% endif %}</div>
          </div>
        </section>

        <section class="section">
          <h3>การติดต่อ</h3>
          <div class="grid grid-auto">
            <div><strong>โทรศัพท์:</strong> {{ obj.cdd_tel }}</div>
            <div><strong>อีเมล:</strong> {{ obj.cdd_email|default:"-" }}</div>
            <div><strong>จังหวัด:</strong> {{ obj.cdd_province|default:"-" }}</div>
          </div>
        </section>

        <section class="section">
          <h3>อุปกรณ์ที่มี</h3>
          <div class="grid grid-auto">
            <div>PC: {{ obj.has_pc|yesno:"มี,ไม่มี" }}</div>
            <div>Laptop: {{ obj.has_laptop|yesno:"มี,ไม่มี" }}</div>
            <div>Wi-Fi: {{ obj.has_wifi|yesno:"มี,ไม่มี" }}</div>
            <div>Headphone: {{ obj.has_headphone|yesno:"มี,ไม่มี" }}</div>
            <div>AnyDesk: {{ obj.has_anydesk|yesno:"มี,ไม่มี" }}</div>
          </div>
        </section>

        {% if obj.cdd_resume and not pdf_mode %}
        <section class="section">
          <h3>Resume</h3>
          <a href="{{ obj.cdd_resume.url }}" target="_blank" style="text-decoration:none; font-weight:700; color:#0f5132;">ดาวน์โหลดไฟล์แนบ</a>
        </section>
        {% endif %}

        {% if not pdf_mode %}
        <div style="margin-top:12px;">
          <a href="{% url 'jobform_pdf' obj.pk %}" target="_blank"
             style="display:inline-block;background:var(--brand);color:#fff;padding:12px 16px;border-radius:12px;text-decoration:none;font-weight:800;">
            ดาวน์โหลด PDF
          </a>
        </div>
        {% endif %}
        {% endif %}
      </main>

      <footer class="footer-note {% if pdf_mode %}only-web{% endif %}">
        กรุณาตรวจสอบข้อมูลให้ถูกต้องก่อนส่งใบสมัคร • หากมีข้อสงสัยกรุณาติดต่อฝ่ายบุคคล
      </footer>
    </div>
  </div>

  <!-- Preview รูปเฉพาะตอนกรอกฟอร์ม -->
  <script>
    (function(){
      var input = document.getElementById("id_cdd_photo");
      var img   = document.getElementById("photoPreview");
      if(input && img){
        input.addEventListener("change", function(){
          var file = this.files && this.files[0];
          if(!file){ img.style.display="none"; img.src=""; return; }
          var reader = new FileReader();
          reader.onload = function(e){ img.src = e.target.result; img.style.display="block"; };
          reader.readAsDataURL(file);
        });
      }
    })();
  </script>
</body>
</html>
