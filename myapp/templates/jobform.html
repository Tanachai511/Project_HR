{% load static %}
<!DOCTYPE html>
<html lang="th" class="{% if pdf_mode %}pdf-mode{% endif %}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% if obj %}ใบสมัคร #{{ obj.pk }}{% else %}ใบสมัครงาน{% endif %}</title>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{ --line:#e2e8f0; }
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#2c3e50 0%,#34495e 100%);
      min-height:100vh;padding:20px;color:#333;
    }
    .container{max-width:800px;margin:0 auto;background:#fff;border-radius:8px;
      box-shadow:0 10px 30px rgba(0,0,0,.2);overflow:hidden}

    /* ===== hero เฉพาะเว็บ ===== */
    .header{background:linear-gradient(135deg,#2c3e50 0%,#3a525f 100%);color:#fff;padding:40px 30px;text-align:center;position:relative}
    .header::before{content:'';position:absolute;inset:0;
      background:url("data:image/svg+xml,%3Csvg width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M20 20c0 11.046-8.954 20-20 20v-40c11.046 0 20 8.954 20 20zM0 0v20c11.046 0 20-8.954 20-20H0z'/%3E%3C/g%3E%3C/svg%3E")}
    .logo-section{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:30px;position:relative;z-index:1}
    .company-logo{width:120px;height:120px;background:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;
      font-weight:bold;color:#27ae60;font-size:14px;text-align:center;line-height:1.2;box-shadow:0 4px 8px rgba(0,0,0,.1)}
    .form-code{background:#27ae60;color:#fff;padding:8px 16px;border-radius:4px;font-size:12px;font-weight:bold;letter-spacing:1px}
    .photo-placeholder{
      width:120px;height:150px;border:1px solid var(--line);border-radius:10px;background:#f3f4f6;overflow:hidden
    }
    .photo-placeholder img{width:100%;height:100%;object-fit:cover;display:block}
    .header-title{position:relative;z-index:1}
    .header h1{font-size:26px;font-weight:700;margin-bottom:8px;letter-spacing:1px}
    .header h2{font-size:22px;font-weight:600;margin-bottom:6px}
    .header p{font-size:14px;opacity:.9;font-style:italic}

    /* ===== เนื้อหา ===== */
    .form-content{padding:40px;background:#fafafa}
    .section{margin-bottom:35px;background:#fff;border-radius:6px;padding:25px;box-shadow:0 2px 8px rgba(0,0,0,.05);border-left:4px solid #27ae60}
    .section h3{color:#2c3e50;font-size:16px;font-weight:700;margin-bottom:20px;text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid #ecf0f1;padding-bottom:8px}
    .form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:20px}
    .form-group{margin-bottom:20px}
    label{display:block;margin-bottom:6px;color:#2c3e50;font-weight:500;font-size:14px}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid #bdc3c7;border-radius:4px;font-size:14px;transition:.3s;background:#fff;font-family:inherit}
    input:focus,select:focus,textarea:focus{outline:none;border-color:#27ae60;box-shadow:0 0 0 2px rgba(39,174,96,.2)}
    textarea{resize:vertical;min-height:80px}
    .checkbox-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:10px}
    .checkbox-item{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid #ecf0f1;border-radius:4px;font-size:13px}
    .file-upload{position:relative}
    .file-upload input[type=file]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}
    .file-upload-btn{display:flex;align-items:center;justify-content:center;gap:8px;padding:12px;border:2px dashed #27ae60;border-radius:4px;background:#f8fff9;color:#27ae60;font-size:14px;font-weight:500}
    .submit-btn{background:linear-gradient(135deg,#27ae60 0%,#2ecc71 100%);color:#fff;padding:15px 40px;border:none;border-radius:4px;
      font-size:16px;font-weight:600;cursor:pointer;width:100%;margin-top:20px;text-transform:uppercase;letter-spacing:1px}
    .form-footer{background:#ecf0f1;padding:20px;text-align:center;color:#7f8c8d;font-size:12px;border-top:1px solid #bdc3c7}

    /* ===== โหมด PDF ===== */
    .pdf-mode .only-web{ display:none !important; }  /* ซ่อน hero สวย ๆ ตอนพิมพ์ */
    .print-header{ padding:16px 24px 0; }
    .print-header .row{ display:flex; align-items:flex-start; gap:12px }
    .print-header .left{ width:28mm }
    .print-header .right{ width:32mm; text-align:right }
    .print-header .center{ flex:1; text-align:center }
    .print-header h1{ margin:0; font-size:18pt }
    .print-header h2{ margin:2mm 0 0; font-size:14pt }
    .print-header p{ margin:1mm 0 0; font-size:9pt; color:#6b7280 }
  </style>

  {% if pdf_mode %}
  <style>
    @page{ size:A4; margin:16mm 14mm 18mm }
    body{ background:#fff }
    .container{ box-shadow:none }
  </style>
  {% endif %}
</head>
<body>
  <div class="container">

    <!-- hero: แสดงเฉพาะบนเว็บ (มีรูปมุมขวาบนสำหรับพรีวิว/แสดง) -->
    <div class="header only-web">
      <div class="logo-section">
        <div class="company-logo">LOGO</div>
        <div class="form-code">ACD-HR-001</div>

        <!-- รูปมุมขวาบน (เว็บ) -->
        <div class="photo-placeholder">
          {% if obj and obj.cdd_photo %}
            <img src="{{ obj.cdd_photo.url }}" alt="รูปถ่ายผู้สมัคร">
          {% else %}
            <img id="photoPreview" alt="" style="display:none;">
          {% endif %}
        </div>
      </div>
      <div class="header-title">
        <h1>APPLICATION FOR EMPLOYMENT</h1>
        <h2>ใบสมัครงาน</h2>
        <p>To be completed in own handwriting</p>
      </div>
    </div>

    <!-- หัวแบบบางสำหรับ PDF (โชว์รูปมุมขวาบน) -->
    {% if pdf_mode and obj %}
      <div class="print-header">
        <div class="row">
          <div class="left"><div class="company-logo" style="width:28mm;height:28mm">LOGO</div></div>
          <div class="center">
            <h1>APPLICATION FOR EMPLOYMENT</h1>
            <h2>ใบสมัครงาน</h2>
            <p>To be completed in own handwriting</p>
          </div>
          <div class="right">
            <div class="form-code" style="display:inline-block;margin-bottom:6px;">ACD-HR-001</div>
            <div class="photo-placeholder" style="width:28mm;height:36mm;display:inline-block;margin-left:6px;">
              {% if obj.cdd_photo %}<img src="{{ obj.cdd_photo.url }}" alt="photo">{% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <div class="form-content">
      {% if form %}
        <!-- ===== โหมดฟอร์มกรอก ===== -->
        <form method="post" action="{% url 'jobform_new' %}" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="section">
            <h3>ประวัติส่วนตัว</h3>
            <div class="form-row">
              <div class="form-group">{{ form.cdd_title.label_tag }}{{ form.cdd_title }}</div>
              <div class="form-group">{{ form.cdd_first_name.label_tag }}{{ form.cdd_first_name }}</div>
              <div class="form-group">{{ form.cdd_last_name.label_tag }}{{ form.cdd_last_name }}</div>
              <div class="form-group">{{ form.cdd_nickname.label_tag }}{{ form.cdd_nickname }}</div>
              <div class="form-group">{{ form.cdd_gender.label_tag }}{{ form.cdd_gender }}</div>
              {% if form.birth_date %}<div class="form-group">{{ form.birth_date.label_tag }}{{ form.birth_date }}</div>{% endif %}
              <div class="form-group">{{ form.cdd_age.label_tag }}{{ form.cdd_age }}</div>
            </div>

            <!-- input อัปโหลดรูป (พรีวิวจะขึ้นมุมขวาบน) -->
            <div class="form-group">
              <label for="id_cdd_photo">อัปโหลดรูปถ่าย (jpg/png):</label><br>
              {{ form.cdd_photo }} {{ form.cdd_photo.errors }}
              <div style="font-size:12px;color:#64748b">ขนาดแนะนำ 3×4 ซม. หรือ 300×400px</div>
            </div>
          </div>

          <div class="section">
            <h3>การสมัครงาน</h3>
            <div class="form-row">
              <div class="form-group">{{ form.cdd_position.label_tag }}{{ form.cdd_position }}</div>
              <div class="form-group">{{ form.education.label_tag }}{{ form.education }}</div>
            </div>
            <div class="form-group">{{ form.work_exp.label_tag }}{{ form.work_exp }}</div>
            <div class="form-group">{{ form.start_date_available.label_tag }}{{ form.start_date_available }}</div>
          </div>

          <div class="section">
            <h3>การติดต่อ</h3>
            <div class="form-row">
              <div class="form-group">{{ form.cdd_tel.label_tag }}{{ form.cdd_tel }}</div>
              <div class="form-group">{{ form.cdd_email.label_tag }}{{ form.cdd_email }}</div>
              <div class="form-group">{{ form.cdd_province.label_tag }}{{ form.cdd_province }}</div>
            </div>
          </div>

          <div class="section">
            <h3>อุปกรณ์</h3>
            <div class="checkbox-grid">
              <label class="checkbox-item">{{ form.has_pc }} คอมพิวเตอร์</label>
              <label class="checkbox-item">{{ form.has_laptop }} โน้ตบุ๊ค</label>
              <label class="checkbox-item">{{ form.has_wifi }} Wi-Fi</label>
              <label class="checkbox-item">{{ form.has_headphone }} Headphone</label>
              <label class="checkbox-item">{{ form.has_anydesk }} AnyDesk</label>
            </div>
          </div>

          <div class="section">
            <h3>Resume / CV</h3>
            <div class="file-upload">
              {{ form.cdd_resume }}
              <div class="file-upload-btn"><span>📎</span><span>เลือกไฟล์ (PDF/DOC)</span></div>
            </div>
          </div>

          <button type="submit" class="submit-btn">ส่งใบสมัครงาน</button>
        </form>

      {% else %}
        <!-- ===== โหมดแสดงผล/พิมพ์ PDF (ใช้ obj) ===== -->
        <div class="section">
          <h3>ประวัติส่วนตัว</h3>
          <!-- ไม่มีรูปในส่วนนี้แล้ว ให้โชว์เฉพาะมุมขวาบนตามฟอร์มจริง -->
          <p>{{ obj.get_cdd_title_display }} {{ obj.cdd_first_name }} {{ obj.cdd_last_name }}</p>
          <p>ชื่อเล่น: {{ obj.cdd_nickname|default:"-" }}</p>
          <p>เพศ: {{ obj.get_cdd_gender_display }}</p>
          <p>อายุ: {% if obj.cdd_age %}{{ obj.cdd_age }} ปี{% else %}-{% endif %}</p>
          {% if obj.birth_date %}<p>วันเกิด: {{ obj.birth_date|date:"d/m/Y" }}</p>{% endif %}
        </div>

        <div class="section">
          <h3>การสมัครงาน</h3>
          <p>ตำแหน่ง: {{ obj.get_cdd_position_display }}</p>
          <p>การศึกษา: {{ obj.education|default:"-" }}</p>
          <p>ประสบการณ์: {{ obj.work_exp|default:"-" }}</p>
          <p>เริ่มงาน: {% if obj.start_date_available %}{{ obj.start_date_available|date:"d/m/Y" }}{% else %}-{% endif %}</p>
        </div>

        <div class="section">
          <h3>การติดต่อ</h3>
          <p>โทรศัพท์: {{ obj.cdd_tel }}</p>
          <p>อีเมล: {{ obj.cdd_email|default:"-" }}</p>
          <p>จังหวัด: {{ obj.cdd_province|default:"-" }}</p>
        </div>

        <div class="section">
          <h3>อุปกรณ์ที่มี</h3>
          <ul>
            <li>PC: {{ obj.has_pc|yesno:"มี,ไม่มี" }}</li>
            <li>Laptop: {{ obj.has_laptop|yesno:"มี,ไม่มี" }}</li>
            <li>Wi-Fi: {{ obj.has_wifi|yesno:"มี,ไม่มี" }}</li>
            <li>Headphone: {{ obj.has_headphone|yesno:"มี,ไม่มี" }}</li>
            <li>AnyDesk: {{ obj.has_anydesk|yesno:"มี,ไม่มี" }}</li>
          </ul>
        </div>

        {% if obj.cdd_resume and not pdf_mode %}
          <div class="section">
            <h3>Resume</h3>
            <a href="{{ obj.cdd_resume.url }}" target="_blank">ดาวน์โหลดไฟล์แนบ</a>
          </div>
        {% endif %}

        {% if not pdf_mode %}
          <div style="margin-top:12px;">
            <a href="{% url 'jobform_pdf' obj.pk %}" target="_blank"
               style="display:inline-block;background:#27ae60;color:#fff;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:700;">
              ดาวน์โหลด PDF
            </a>
          </div>
        {% endif %}
      {% endif %}
    </div>

    <div class="form-footer {% if pdf_mode %}only-web{% endif %}">
      <p>กรุณาตรวจสอบข้อมูลให้ถูกต้องก่อนส่งใบสมัคร • หากมีข้อสงสัยกรุณาติดต่อฝ่ายบุคคล</p>
    </div>
  </div>

  <!-- พรีวิวรูปเฉพาะมุมขวาบนตอนกรอกฟอร์ม -->
  <script>
  (function(){
    const input = document.getElementById("id_cdd_photo");
    const img   = document.getElementById("photoPreview");
    if(input && img){
      input.addEventListener("change", function(){
        const file = this.files && this.files[0];
        if(!file){ img.style.display = "none"; img.src = ""; return; }
        const reader = new FileReader();
        reader.onload = e => { img.src = e.target.result; img.style.display = "block"; };
        reader.readAsDataURL(file);
      });
    }
  })();
  </script>
</body>
</html>
