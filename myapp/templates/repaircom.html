{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ASCENDER Co., Ltd — แจ้งซ่อม</title>
  <link rel="stylesheet" href="{% static 'style.css' %}">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#2d5a4b 0%,#1e4037 100%);min-height:100vh;padding:20px;color:#333}
    .header{position:fixed;top:0;left:0;right:0;background:#10352d;box-shadow:0 8px 16px rgba(0,0,0,.15);z-index:50}
    .nav-container{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:14px 16px;color:#fff}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.5px}
    .logo-icon img{width:32px;height:32px;border-radius:8px;object-fit:cover}
    .nav-menu{display:flex;gap:18px;list-style:none}
    .nav-menu a{color:#e5f7f1;text-decoration:none;padding:8px 12px;border-radius:10px}
    .nav-menu a:hover{background:#1d4f42}
    .container{max-width:900px;margin:120px auto 24px auto;background:#fff;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.15);overflow:hidden;animation:slideIn .6s ease-out}
    @keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .form-header{background:linear-gradient(135deg,#34a07a 0%,#2d5a4b 100%);color:#fff;text-align:center;padding:36px 28px;position:relative;overflow:hidden}
    .form-header h1{font-size:2rem;font-weight:600;margin:0}
    .form-body{padding:32px 28px}
    .alerts{margin-bottom:16px}
    .alert{padding:12px 14px;border-radius:12px;margin-bottom:10px;font-size:.95rem}
    .alert-success{background:#e8fff6;color:#056b42;border:1px solid #b9f0d7}
    .alert-error{background:#fff1f0;color:#a31212;border:1px solid #f4c7c6}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-bottom:10px}
    .form-group{display:flex;flex-direction:column;gap:8px}
    .form-group.full-width{grid-column:1/-1}
    label{font-weight:600;color:#2d5a4b}
    input, select, textarea{width:100%;padding:14px 16px;border:2px solid #e1e8e6;border-radius:12px;background:#fafbfa;font-size:1rem;transition:all .25s ease;outline:none}
    input:focus,select:focus,textarea:focus{border-color:#34a07a;background:#fff;box-shadow:0 0 0 4px rgba(52,160,122,.1);transform:translateY(-2px)}
    textarea{min-height:120px;resize:vertical}
    .readonly{background:#f5f7f7;color:#333}
    .submit-section{text-align:center;padding-top:16px;border-top:1px solid #e9eff0;margin-top:12px}
    .submit-btn{background:linear-gradient(135deg,#34a07a 0%,#2d5a4b 100%);color:#fff;border:none;padding:16px 34px;border-radius:999px;font-size:1.05rem;font-weight:700;cursor:pointer;transition:all .25s ease;box-shadow:0 8px 20px rgba(52,160,122,.3)}
    .submit-btn:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(52,160,122,.4)}
    .errorlist{margin:6px 0 0 0;padding:0;list-style:none;color:#b42318;font-size:.9rem}
    @media(max-width:768px){.form-grid{grid-template-columns:1fr}.container{margin:100px 12px}}


        .user-menu { position: relative; }
    .user-button{
      display:flex; align-items:center; gap:.5rem;
      background: transparent; border:0; cursor:pointer; padding:.35rem .5rem;
      border-radius: 999px;
    }
    .user-button:hover{ background: rgba(0,0,0,.06); }
    .avatar{
      width:28px; height:28px; border-radius:50%;
      display:inline-flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg, #4a7c59, #6b8e5a); color:#fff; font-weight:700;
    }
    .avatar.lg{ width:40px; height:40px; font-size:1rem; }
    .user-name{ font-weight:600; color:#333; }
    .chev{ opacity:.7; }
    .dropdown{
      position:absolute; right:0; top:110%;
      width:280px; background:#fff; border-radius:14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
      overflow:hidden; z-index:9999;
    }
    .hidden{ display:none; }
    .dropdown-header{
      display:flex; gap:.8rem; align-items:center; padding:14px 14px 10px;
      background: linear-gradient(135deg, #f6faf8, #ffffff);
      border-bottom:1px solid #eef2ef;
    }
    .dropdown-header .info .name{ font-weight:700; color:#1b2b21; line-height:1.2; }
    .dropdown-header .info .email{ font-size:.9rem; color:#667; }
    .dropdown-body{ padding:8px; }
    .dropdown-body .item{
      width:100%; display:flex; align-items:center; gap:.6rem;
      padding:10px 10px; border-radius:10px; color:#233; text-decoration:none;
      background:transparent; border:0;
    }
    .dropdown-body .item:hover{ background:#f3f7f5; }
    .logout-btn{
      width:100%; text-align:left; background:transparent; border:0; cursor:pointer;
      color:#b01d1d; font-weight:600;
    }
    /* ===== NAVBAR BASE ===== */
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Prompt,Arial,sans-serif;}

.header{
  position:fixed; top:0; left:0; right:0;
  background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.08);
  z-index:1000;
}
.nav-container{
  max-width:1200px; margin:0 auto; padding:10px 20px;
  display:flex; align-items:center; justify-content:space-between;
}

.logo{display:flex; align-items:center; gap:10px; font-weight:600; color:#1f2937;}
.logo-icon{display:flex; align-items:center;}
.logo-icon img{width:44px; height:44px; object-fit:contain; display:block;}

.nav-menu{
  list-style:none; margin:0; padding:0;
  display:flex; align-items:center; gap:20px;
}
.nav-menu a{
  text-decoration:none; color:#374151; font-weight:500;
}
.nav-btn{
  padding:8px 14px; border:1px solid #10b981; border-radius:10px;
  color:#065f46; font-weight:600;
}

/* ดันคอนเทนต์ลงให้ไม่โดนทับ */
:root{ --nav-h:72px; }
body{ padding-top:var(--nav-h); }

/* ===== HERO / SLIDES ===== */
.hero{ position:relative; overflow:hidden; height:420px; }
.slideshow-container{ position:relative; width:100%; height:100%; }
.slide{ position:absolute; inset:0; opacity:0; transition:opacity 1.2s; }
.slide.active{ opacity:1; }
.slide img{ width:100%; height:100%; object-fit:cover; display:block; }

/* จุดบอกสไลด์ */
.slide-indicators{
  position:absolute; left:0; right:0; bottom:14px; display:flex; gap:8px; justify-content:center;
}
.dot{ width:10px; height:10px; border-radius:50%; background:#e5e7eb; cursor:pointer; }
.dot.active{ background:#10b981; }

body {
  margin: 0;
  padding: 0;
  margin-top: 8px;
}
.readonly {
  background: #f6f8f7;
  border: 1px solid #e0e0e0;
  color: #333;
  pointer-events: none;
}


    *{ box-sizing:border-box; }
      html,body{ overflow-x:hidden; font-family:"Prompt", sans-serif; }
      :root{ --header-h:72px; }
      @media (max-width:992px){ :root{ --header-h:64px; } }

      body {
        margin: 0;
        padding: 0;
        margin-top: 8px;
      }

      .header{
        position:fixed; top:0; left:0; right:0;
        z-index:1000; background:#fff;
        box-shadow:0 2px 6px rgba(0,0,0,.08);
      }
      .nav-container{ height:var(--header-h); display:flex; align-items:center; justify-content:space-between; padding:0 1.5rem; }

      main, .page-wrap, .content, body > :not(.header){ margin-top:var(--header-h); }

      /* ===== Logo ===== */
      .logo{ display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.5rem; color:#1a1a1a; }
      .logo-icon{ width:44px; height:44px; border-radius:50%; overflow:hidden; background:#6b8e5a; display:flex; align-items:center; justify-content:center; }
      .logo-icon img{ width:100%; height:100%; object-fit:cover; }

      /* ===== Desktop Menu ===== */
      .nav-menu{
        display:flex; list-style:none; gap:2rem; align-items:center;
        font-size:1.125rem;  /* ≈18px */
      }
      .nav-menu li a{
        text-decoration:none; color:#333;
        font-weight:600;
        transition:color .3s ease;
      }
      .nav-menu li a:hover{ color:#40e371; }

      /* ===== Button (desktop + mobile) ===== */
      .nav-btn{
        background-color:#6b8e5a !important;
        color:#fff !important;
        padding:0.65rem 1.6rem !important;
        border-radius:25px !important;
        text-decoration:none !important;
        transition:all .3s ease !important;
        font-weight:700;
      }
      .nav-btn:hover{ background-color:#4a7c59 !important; transform:translateY(-2px) !important; }

      /* ===== Hamburger ===== */
      .menu-toggle{
        display:none;
        background:none;
        border:1.5px solid #2f3b2f;
        border-radius:10px;
        width:44px; height:44px;
        font-size:1.5rem;
        line-height:1;
        cursor:pointer;
      }

      /* ===== Mobile Drawer ===== */
      @media (max-width:992px){
        .menu-toggle{ display:inline-block; }

        .nav-menu{ display:none; }

        .nav-menu.active{
          display:flex;
          flex-direction:column;
          position:fixed;
          margin:0 !important; 
          top:var(--header-h); left:0; right:0; bottom:0;
          width:100vw; max-width:100vw;
          padding:8px 14px 12px;
          gap:6px;
          background:#fff;
          overflow-y:auto;
          border-top:1px solid #eee;
          justify-content:flex-start;
          z-index:1001;
        }


        .nav-menu li a{
          display:block;
          width:100%;
          padding:14px 10px;
          font-size:1.25rem;      /* ≈20px */
          line-height:1.6;
          text-align:center;
          white-space:normal;
          word-break:break-word;
        }

        .nav-btn{
          width:100% !important;
          font-size:1.25rem;
          padding:1rem 1.2rem !important;
          border-radius:12px !important;
          text-align:center;
        }

        body.menu-open{ overflow:hidden; }
      }
    .user-menu { position: relative; }
    .user-button{
      display:flex; align-items:center; gap:.5rem;
      background: transparent; border:0; cursor:pointer; padding:.35rem .5rem;
      border-radius: 999px;
    }
    .user-button:hover{ background: rgba(0,0,0,.06); }
    .avatar{
      width:28px; height:28px; border-radius:50%;
      display:inline-flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg, #4a7c59, #6b8e5a); color:#fff; font-weight:700;
    }
    .avatar.lg{ width:40px; height:40px; font-size:1rem; }
    .user-name{ font-weight:600; color:#333; }
    .chev{ opacity:.7; }
    .dropdown{
      position:absolute; right:0; top:110%;
      width:280px; background:#fff; border-radius:14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
      overflow:hidden; z-index:9999;
    }
    .hidden{ display:none; }
    .dropdown-header{
      display:flex; gap:.8rem; align-items:center; padding:14px 14px 10px;
      background: linear-gradient(135deg, #f6faf8, #ffffff);
      border-bottom:1px solid #eef2ef;
    }
    .dropdown-header .info .name{ font-weight:700; color:#1b2b21; line-height:1.2; }
    .dropdown-header .info .email{ font-size:.9rem; color:#667; }
    .dropdown-body{ padding:8px; }
    .dropdown-body .item{
      width:100%; display:flex; align-items:center; gap:.6rem;
      padding:10px 10px; border-radius:10px; color:#233; text-decoration:none;
      background:transparent; border:0;
    }
    .dropdown-body .item:hover{ background:#f3f7f5; }
    .logout-btn{
      width:100%; text-align:left; background:transparent; border:0; cursor:pointer;
      color:#b01d1d; font-weight:600;
    }
  </style>
</head>
<body>
{% include 'header_emp.html' %}

  <!-- Form Card -->
  <div class="container">
    <div class="form-header">
      <h1>แจ้งซ่อมทั่วไปของบริษัท</h1>
    </div>

    <div class="form-body">
      <!-- Messages -->
      <div class="alerts">
        {% if messages %}
          {% for m in messages %}
            <div class="alert {% if m.tags == 'success' %}alert-success{% else %}alert-error{% endif %}">{{ m }}</div>
          {% endfor %}
        {% endif %}
      </div>

      <!-- ฟอร์มแจ้งซ่อม -->
      <form id="repairForm" method="post" action="{% url 'repair-create' %}" enctype="multipart/form-data" novalidate>
        {% csrf_token %}

        <div class="form-grid">

          <!-- ผู้แจ้ง (อ่านอย่างเดียว จาก request.user.employee) -->
          <div class="form-group">
            <label>ผู้แจ้ง</label>
            <input type="text" class="readonly" value="{{ employee.emp_name }}" readonly>
          </div>

          <!-- วันที่แจ้งซ่อม -->
          <div class="form-group">
            <label for="{{ form.repair_date.id_for_label }}">วันที่แจ้งซ่อม</label>
            {{ form.repair_date }}
            {% if form.repair_date.errors %}<ul class="errorlist"><li>{{ form.repair_date.errors|join:", " }}</li></ul>{% endif %}
          </div>

          <!-- ประเภทงานซ่อม -->
          <div class="form-group">
            <label for="{{ form.repair_type.id_for_label }}">ประเภทงานซ่อม</label>

            {% if locked_type %}
              <!-- ส่งค่าจริงไปกับฟอร์ม -->
              <input type="hidden" name="{{ form.repair_type.name }}" value="{{ locked_type }}">
              <!-- แสดงผลเป็น readonly -->
              <input type="text" class="readonly" value="{{ locked_type_label }}" readonly>
            {% else %}
              {{ form.repair_type }}
            {% endif %}

            {% if form.repair_type.errors %}
              <ul class="errorlist"><li>{{ form.repair_type.errors|join:", " }}</li></ul>
            {% endif %}
          </div>

          <!-- สถานที่ -->
          <div class="form-group">
            <label for="{{ form.repair_location.id_for_label }}">สถานที่</label>
            {{ form.repair_location }}
            {% if form.repair_location.errors %}<ul class="errorlist"><li>{{ form.repair_location.errors|join:", " }}</li></ul>{% endif %}
          </div>

          <!-- อาการ/ปัญหา -->
          <div class="form-group full-width">
            <label for="{{ form.repair_problem.id_for_label }}">อาการ/ปัญหา</label>
            {{ form.repair_problem }}
            {% if form.repair_problem.errors %}<ul class="errorlist"><li>{{ form.repair_problem.errors|join:", " }}</li></ul>{% endif %}
          </div>

          <!-- สาเหตุ (ถ้ามี) -->
          <div class="form-group full-width">
            <label for="{{ form.repair_cause.id_for_label }}">สาเหตุ (ถ้ามี)</label>
            {{ form.repair_cause }}
            {% if form.repair_cause.errors %}<ul class="errorlist"><li>{{ form.repair_cause.errors|join:", " }}</li></ul>{% endif %}
          </div>

          <!-- แนบรูป -->
          <div class="form-group full-width">
            <label for="{{ form.repair_img.id_for_label }}">แนบรูป (ถ้ามี)</label>
            {{ form.repair_img }}
            {% if form.repair_img.errors %}<ul class="errorlist"><li>{{ form.repair_img.errors|join:", " }}</li></ul>{% endif %}
          </div>

        </div>

        <div class="submit-section">
          <button type="submit" class="submit-btn">ส่งแจ้งซ่อม</button>
        </div>
      </form>
    </div>
  </div>

  
  {% include 'footer.html' %}
  <script>
    function toggleMenu(){
      const menu = document.getElementById('nav-menu');
      const open = !menu.classList.contains('active');
      menu.classList.toggle('active', open);
      document.body.classList.toggle('menu-open', open);
    }

    (function(){
    const btn = document.getElementById('userMenuBtn');
    const dd  = document.getElementById('userDropdown');
    if(!btn || !dd) return;

    btn.addEventListener('click', function(e){
      e.stopPropagation();
      const isHidden = dd.classList.contains('hidden');
      dd.classList.toggle('hidden', !isHidden);
      this.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
    });

    document.addEventListener('click', function(){
      if(!dd.classList.contains('hidden')){
        dd.classList.add('hidden');
        btn.setAttribute('aria-expanded', 'false');
      }
    });

    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape' && !dd.classList.contains('hidden')){
        dd.classList.add('hidden');
        btn.setAttribute('aria-expanded', 'false');
      }
    });
  })();
  </script>
</body>
</html>
