{% load static %}
<!DOCTYPE html>
<html lang="th" class="{% if pdf_mode %}pdf-mode{% endif %}">
<head>
  <meta charset="utf-8">
  <title>ใบแจ้งซ่อม #{{ obj.id }}</title>
  <style>

    :root{
      --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --chip:#f3f4f6;
      --brand:#2d5a4b; --ok:#16a34a; --warn:#eab308; --bad:#ef4444;
    }
    @page{ size:A4; margin:16mm 14mm 18mm 14mm; }
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      font-family: "Noto Sans Thai","TH Sarabun New",system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink); background:#fff;
    }
    .page{ max-width:820px; margin:0 auto; padding:12px; }

    /* ---------- Header (slim, friendly to PDF) ---------- */
    .head{
      display:grid; grid-template-columns: 32mm 1fr 36mm; gap:12px; align-items:start; margin-bottom:10px;
    }
    .logo{
      width:32mm; height:32mm; border-radius:8px; background:#f8fafc; border:1px solid var(--line);
      display:grid; place-items:center; color:var(--brand); font-weight:800;
    }
    .title{ text-align:center; }
    .title h1{ font-size:18pt; line-height:1.15; font-weight:800; letter-spacing:.3px; }
    .title .sub{ color:var(--muted); margin-top:3px; font-size:10pt; }
    .meta{
      text-align:right;
    }
    .code{
      display:inline-block; background:#34a07a; color:#fff; font-weight:800;
      padding:4px 8px; border-radius:8px; font-size:10pt; margin-bottom:6px;
    }
    .photo{
      width:28mm; height:36mm; border:1px solid var(--line); border-radius:6px;
      background:#f3f4f6; overflow:hidden; margin-left:auto;
    }
    .photo img{ width:100%; height:100%; object-fit:cover; display:block; }

    /* ---------- Sections ---------- */
    .section{
      border:1px solid var(--line); border-radius:12px; padding:14px; margin:12px 0;
      box-shadow:0 1px 0 rgba(0,0,0,.02);
    }
    .section h2{
      font-size:12.5pt; margin-bottom:10px; font-weight:800;
      border-left:4px solid var(--brand); padding-left:8px;
    }
    .grid-2{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px 16px;
    }
    .row{ display:grid; grid-template-columns: 160px 1fr; gap:10px; }
    .label{ color:var(--muted); font-weight:700; }

    .para{ white-space:pre-wrap; line-height:1.55; }
    .thumb{ margin-top:8px; }
    .thumb img{ max-width:100%; max-height:300px; border:1px solid var(--line); border-radius:8px; display:block; }

    /* ---------- Badges ---------- */
    .badge{
      display:inline-block; border-radius:999px; padding:3px 10px; font-size:10pt; font-weight:800; background:var(--chip);
      border:1px solid var(--line); color:#0f172a;
    }

    /* ---------- Signatures ---------- */
    .sign{
      display:grid; grid-template-columns: 1fr 1fr; gap:20px;
      margin-top:6px;
    }
    .sigbox{
      border:1px dashed var(--line); border-radius:10px; padding:12px; min-height:80px;
    }
    .sigcap{ color:var(--muted); font-size:10pt; margin-top:6px; }

    /* ---------- Footer ---------- */
    .foot{
      margin-top:10px; color:var(--muted); font-size:9.5pt; text-align:center;
      border-top:1px solid var(--line); padding-top:8px;
    }
  </style>
</head>
<body>
  <div class="page">

    <!-- Summary -->
    <section class="section">
      <h2>ข้อมูลหลัก • แจ้งซ่อม #{{ obj.id }}</h2>
      <div class="grid-2">
        <div class="row"><div class="label">วันที่แจ้ง</div>    <div class="val">{{ obj.repair_date|date:"d/m/Y" }}</div></div>
        <div class="row"><div class="label">สถานะ</div>        <div class="val"><span class="badge">{{ obj.get_repair_status_display }}</span></div></div>

        <div class="row"><div class="label">ผู้แจ้ง</div>       <div class="val">{{ obj.employee.emp_name }}</div></div>
        <div class="row"><div class="label">ประเภทงาน</div>    <div class="val">{{ obj.get_repair_type_display }}</div></div>

        <div class="row"><div class="label">สถานที่</div>       <div class="val">{{ obj.repair_location|default:"-" }}</div></div>
      </div>
    </section>

    <!-- Problem -->
    <section class="section">
      <h2>อาการ/ปัญหา</h2>
      <div class="para">{{ obj.repair_problem|default:"-" }}</div>
    </section>

    <!-- Cause -->
    {% if obj.repair_cause %}
    <section class="section">
      <h2>สาเหตุ (ถ้ามี)</h2>
      <div class="para">{{ obj.repair_cause }}</div>
    </section>
    {% endif %}

    <!-- Attachment (big) -->
    {% if obj.repair_img %}
    <section class="section">
      <h2>รูปภาพประกอบ</h2>
      <div class="thumb"><img src="{{ obj.repair_img.url }}" alt="แนบรูป"></div>
    </section>
    {% endif %}
  </div>
  <script>
      (function(){
    const btn = document.getElementById('userMenuBtn');
    const dd  = document.getElementById('userDropdown');
    if(!btn || !dd) return;

    btn.addEventListener('click', function(e){
      e.stopPropagation();
      const isHidden = dd.classList.contains('hidden');
      dd.classList.toggle('hidden', !isHidden);
      this.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
    });

    document.addEventListener('click', function(){
      if(!dd.classList.contains('hidden')){
        dd.classList.add('hidden');
        btn.setAttribute('aria-expanded', 'false');
      }
    });

    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape' && !dd.classList.contains('hidden')){
        dd.classList.add('hidden');
        btn.setAttribute('aria-expanded', 'false');
      }
    });
  })();
  </script>
</body>
</html>
